<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1280 720" width="1280" height="720">
  <defs>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&amp;display=swap');

      .slide-title { font-family: 'Inter', sans-serif; font-size: 48px; font-weight: 700; fill: #1e3a5f; }
      .section-title { font-family: 'Inter', sans-serif; font-size: 24px; font-weight: 600; fill: #2c5282; }
      .step-title { font-family: 'Inter', sans-serif; font-size: 16px; font-weight: 600; fill: #ffffff; }
      .step-text { font-family: 'Inter', sans-serif; font-size: 13px; font-weight: 400; fill: #ffffff; }
      .body-text { font-family: 'Inter', sans-serif; font-size: 14px; font-weight: 400; fill: #2d3748; }
      .small-text { font-family: 'Inter', sans-serif; font-size: 12px; font-weight: 400; fill: #4a5568; }
      .decision-text { font-family: 'Inter', sans-serif; font-size: 14px; font-weight: 600; fill: #2d3748; }
    </style>

    <linearGradient id="bg-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#e6f2ff;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#f0f9ff;stop-opacity:1" />
    </linearGradient>

    <linearGradient id="step-gradient" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#3182ce;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#2c5282;stop-opacity:1" />
    </linearGradient>

    <linearGradient id="cache-gradient" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#38a169;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#2f855a;stop-opacity:1" />
    </linearGradient>

    <linearGradient id="fetch-gradient" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#d97706;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#b45309;stop-opacity:1" />
    </linearGradient>

    <linearGradient id="final-gradient" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#5a67d8;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#4c51bf;stop-opacity:1" />
    </linearGradient>

    <marker id="arrowhead-blue" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#3182ce" />
    </marker>

    <marker id="arrowhead-green" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#38a169" />
    </marker>

    <marker id="arrowhead-orange" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#d97706" />
    </marker>

    <marker id="arrowhead-purple" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#5a67d8" />
    </marker>
  </defs>

  <!-- Background -->
  <rect width="1280" height="720" fill="url(#bg-gradient)"/>

  <!-- Header -->
  <rect x="0" y="0" width="1280" height="100" fill="#1e3a5f" opacity="0.05"/>
  <text x="640" y="60" class="slide-title" text-anchor="middle">Data Flow Diagram</text>

  <!-- Flowchart -->
  <g id="flowchart">
    <!-- Step 1: User Action -->
    <rect x="490" y="110" width="300" height="60" fill="url(#step-gradient)" rx="8"/>
    <text x="640" y="135" class="step-title" text-anchor="middle">1. User Enables Climate Linkage</text>
    <text x="640" y="155" class="step-text" text-anchor="middle">Study.needs_climate_linkage = True</text>

    <!-- Arrow -->
    <line x1="640" y1="170" x2="640" y2="200" stroke="#3182ce" stroke-width="3" marker-end="url(#arrowhead-blue)"/>

    <!-- Step 2: Configuration -->
    <rect x="490" y="200" width="300" height="70" fill="url(#step-gradient)" rx="8"/>
    <text x="640" y="225" class="step-title" text-anchor="middle">2. User Configures Request</text>
    <text x="640" y="245" class="step-text" text-anchor="middle">Data source, variables, date range,</text>
    <text x="640" y="260" class="step-text" text-anchor="middle">aggregation method, spatial buffer</text>

    <!-- Arrow -->
    <line x1="640" y1="270" x2="640" y2="300" stroke="#3182ce" stroke-width="3" marker-end="url(#arrowhead-blue)"/>

    <!-- Step 3: Request Created -->
    <rect x="490" y="300" width="300" height="60" fill="url(#step-gradient)" rx="8"/>
    <text x="640" y="325" class="step-title" text-anchor="middle">3. ClimateDataRequest Created</text>
    <text x="640" y="345" class="step-text" text-anchor="middle">status = 'pending'</text>

    <!-- Arrow -->
    <line x1="640" y1="360" x2="640" y2="390" stroke="#3182ce" stroke-width="3" marker-end="url(#arrowhead-blue)"/>

    <!-- Step 4: Celery Task -->
    <rect x="490" y="390" width="300" height="60" fill="url(#step-gradient)" rx="8"/>
    <text x="640" y="415" class="step-title" text-anchor="middle">4. Celery Task Triggered</text>
    <text x="640" y="435" class="step-text" text-anchor="middle">status = 'processing'</text>

    <!-- Arrow to decision -->
    <line x1="640" y1="450" x2="640" y2="480" stroke="#3182ce" stroke-width="3" marker-end="url(#arrowhead-blue)"/>

    <!-- Decision Diamond: Cache Check -->
    <g id="cache-decision">
      <polygon points="640,480 760,520 640,560 520,520" fill="#f7fafc" stroke="#3182ce" stroke-width="3"/>
      <text x="640" y="520" class="decision-text" text-anchor="middle">Cache</text>
      <text x="640" y="535" class="decision-text" text-anchor="middle">Hit?</text>
    </g>

    <!-- Cache Hit Path (Left) -->
    <g id="cache-hit-path">
      <text x="420" y="525" class="body-text" font-weight="600" fill="#38a169">YES</text>
      <line x1="520" y1="520" x2="360" y2="520" stroke="#38a169" stroke-width="3" marker-end="url(#arrowhead-green)"/>

      <rect x="180" y="490" width="180" height="60" fill="url(#cache-gradient)" rx="8"/>
      <text x="270" y="515" class="step-title" text-anchor="middle">5a. Retrieve from</text>
      <text x="270" y="535" class="step-title" text-anchor="middle">ClimateDataCache</text>

      <!-- Arrow down from cache -->
      <line x1="270" y1="550" x2="270" y2="590" stroke="#38a169" stroke-width="3"/>
      <line x1="270" y1="590" x2="490" y2="590" stroke="#38a169" stroke-width="3" marker-end="url(#arrowhead-green)"/>
    </g>

    <!-- Cache Miss Path (Right) -->
    <g id="cache-miss-path">
      <text x="820" y="525" class="body-text" font-weight="600" fill="#d97706">NO</text>
      <line x1="760" y1="520" x2="920" y2="520" stroke="#d97706" stroke-width="3" marker-end="url(#arrowhead-orange)"/>

      <!-- Fetch from API -->
      <rect x="920" y="470" width="230" height="50" fill="url(#fetch-gradient)" rx="8"/>
      <text x="1035" y="495" class="step-title" text-anchor="middle">5b. Fetch from Data Source</text>
      <text x="1035" y="512" class="step-text" text-anchor="middle">EarthEngine / Copernicus / etc.</text>

      <!-- Arrow down -->
      <line x1="1035" y1="520" x2="1035" y2="550" stroke="#d97706" stroke-width="3" marker-end="url(#arrowhead-orange)"/>

      <!-- Store in Cache -->
      <rect x="920" y="550" width="230" height="50" fill="url(#fetch-gradient)" rx="8"/>
      <text x="1035" y="575" class="step-title" text-anchor="middle">6. Store in Cache</text>
      <text x="1035" y="592" class="step-text" text-anchor="middle">expires_at = now + 30 days</text>

      <!-- Arrow back to main flow -->
      <line x1="920" y1="590" x2="790" y2="590" stroke="#d97706" stroke-width="3" marker-end="url(#arrowhead-orange)"/>
    </g>

    <!-- Processing Steps -->
    <g id="processing">
      <!-- Apply Aggregation -->
      <rect x="490" y="575" width="300" height="50" fill="url(#final-gradient)" rx="8"/>
      <text x="640" y="595" class="step-title" text-anchor="middle">7. Apply Temporal Aggregation</text>
      <text x="640" y="612" class="step-text" text-anchor="middle">Daily, Weekly, Monthly</text>

      <!-- Arrow -->
      <line x1="640" y1="625" x2="640" y2="645" stroke="#5a67d8" stroke-width="3" marker-end="url(#arrowhead-purple)"/>

      <!-- Create Observations -->
      <rect x="490" y="645" width="300" height="50" fill="url(#final-gradient)" rx="8"/>
      <text x="640" y="665" class="step-title" text-anchor="middle">8. Create Observation Records</text>
      <text x="640" y="682" class="step-text" text-anchor="middle">Linked to Study, Location, TimeDimension</text>
    </g>

    <!-- Final Step -->
    <line x1="490" y1="670" x2="420" y2="670" stroke="#5a67d8" stroke-width="3"/>
    <line x1="420" y1="670" x2="420" y2="350" stroke="#5a67d8" stroke-width="3"/>
    <line x1="420" y1="350" x2="100" y2="350" stroke="#5a67d8" stroke-width="3" marker-end="url(#arrowhead-purple)"/>

    <rect x="50" y="320" width="200" height="60" fill="url(#final-gradient)" rx="8"/>
    <text x="150" y="345" class="step-title" text-anchor="middle">9. Request Complete</text>
    <text x="150" y="365" class="step-text" text-anchor="middle">status = 'completed'</text>
  </g>

  <!-- Legend -->
  <g id="legend">
    <rect x="50" y="130" width="300" height="150" fill="#ffffff" stroke="#cbd5e0" stroke-width="2" rx="8"/>
    <text x="200" y="155" class="section-title" text-anchor="middle">Data Sources</text>

    <circle cx="80" cy="180" r="8" fill="#3182ce"/>
    <text x="100" y="185" class="small-text">Google Earth Engine</text>

    <circle cx="80" cy="205" r="8" fill="#3182ce"/>
    <text x="100" y="210" class="small-text">Copernicus ERA5</text>

    <circle cx="80" cy="230" r="8" fill="#3182ce"/>
    <text x="100" y="235" class="small-text">WorldClim</text>

    <circle cx="80" cy="255" r="8" fill="#3182ce"/>
    <text x="100" y="260" class="small-text">CHIRPS, MODIS, OpenWeather</text>
  </g>

  <!-- Key Features Box -->
  <g id="features">
    <rect x="50" y="420" width="300" height="140" fill="#ffffff" stroke="#cbd5e0" stroke-width="2" rx="8"/>
    <text x="200" y="445" class="section-title" text-anchor="middle">Key Features</text>

    <text x="70" y="470" class="small-text" font-weight="600">Cache Strategy:</text>
    <text x="70" y="488" class="small-text">• 30-day expiration</text>
    <text x="70" y="505" class="small-text">• Reduces API calls</text>

    <text x="70" y="530" class="small-text" font-weight="600">Error Handling:</text>
    <text x="70" y="548" class="small-text">• Retry logic on failure</text>
    <text x="70" y="565" class="small-text">• Status tracking throughout</text>
  </g>

  <!-- Footer -->
  <text x="640" y="710" class="small-text" text-anchor="middle">HarmonAIze Climate Module - Technical Documentation</text>
</svg>