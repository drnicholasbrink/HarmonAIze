{% if variables %}
<div class="variable-list" id="variable-list">
  <!-- Category Filter -->
  <div class="btn-group mb-3 d-flex flex-wrap gap-2" role="group">
    <button type="button"
            class="btn btn-sm btn-outline-primary {% if not filter_category %}active{% endif %}"
            hx-get="{% url 'climate:variable_list_partial' %}?source_id={{ source_id }}"
            hx-target="#variable-list"
            hx-swap="outerHTML">
      All ({{ variables.count }})
    </button>
    {% for cat in categories %}
    <button type="button"
            class="btn btn-sm btn-outline-primary {% if filter_category == cat.category %}active{% endif %}"
            hx-get="{% url 'climate:variable_list_partial' %}?source_id={{ source_id }}&category={{ cat.category }}"
            hx-target="#variable-list"
            hx-swap="outerHTML">
      {{ cat.category|title }} ({{ cat.count }})
    </button>
    {% endfor %}
  </div>

  <!-- Variable Checkboxes -->
  <div class="row">
    {% for variable in variables %}
    <div class="col-md-6 mb-2">
      <div class="form-check">
        <input class="form-check-input"
               type="checkbox"
               name="variables"
               value="{{ variable.id }}"
               id="var_{{ variable.id }}"
               {% if variable.id in selected_variables %}checked{% endif %}>
        <label class="form-check-label" for="var_{{ variable.id }}">
          <strong>{{ variable.display_name }}</strong>
          <br>
          <small class="text-muted">
            {{ variable.description|truncatewords:8 }}
            {% if variable.unit %} ({{ variable.unit }}){% endif %}
          </small>
        </label>
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- Selected Count -->
  <div class="mt-3 p-2 bg-light rounded">
    <small>
      <i class="bi bi-check2-square"></i>
      <span id="selected-count">{{ selected_variables|length }}</span> variable(s) selected
    </small>
  </div>
</div>
{% else %}
<div class="alert alert-warning" id="variable-list">
  <i class="bi bi-exclamation-triangle"></i>
  No variables available for this data source and category combination.
</div>
{% endif %}

<script>
// Update selected count when checkboxes change
document.addEventListener('DOMContentLoaded', function() {
  const checkboxes = document.querySelectorAll('input[name="variables"]');
  const countDisplay = document.getElementById('selected-count');

  checkboxes.forEach(checkbox => {
    checkbox.addEventListener('change', function() {
      const checkedCount = document.querySelectorAll('input[name="variables"]:checked').length;
      if (countDisplay) {
        countDisplay.textContent = checkedCount;
      }
    });
  });
});
</script>
