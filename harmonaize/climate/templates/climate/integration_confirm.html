{% extends "base.html" %}

{% block title %}Confirm Climate Integration - {{ climate_request.study.name }}{% endblock %}

{% block content %}
<div class="container-fluid py-4">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <!-- Header -->
      <div class="card shadow-sm mb-4">
        <div class="card-body">
          <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-0">
              <li class="breadcrumb-item"><a href="{% url 'core:project_list' %}">Projects</a></li>
              <li class="breadcrumb-item"><a href="{% url 'climate:request_detail' climate_request.id %}">Climate Request #{{ climate_request.id }}</a></li>
              <li class="breadcrumb-item active">Confirm Integration</li>
            </ol>
          </nav>
        </div>
      </div>

      <!-- Confirmation Card -->
      <div class="card shadow">
        <div class="card-header bg-warning text-dark">
          <h4 class="mb-0">Confirm Climate Data Integration</h4>
        </div>
        <div class="card-body">
          <div class="alert alert-info">
            <h5>You are about to process climate data with the following configuration:</h5>
          </div>

          <div class="row mt-4">
            <div class="col-md-6">
              <h6 class="text-muted">Study</h6>
              <p class="fw-bold">{{ climate_request.study.name }}</p>

              <h6 class="text-muted mt-3">Data Source</h6>
              <p class="fw-bold">{{ climate_request.data_source.name }}</p>

              <h6 class="text-muted mt-3">Date Range</h6>
              <p class="fw-bold">{{ climate_request.start_date }} to {{ climate_request.end_date }}</p>
            </div>
            <div class="col-md-6">
              <h6 class="text-muted">Locations</h6>
              <p class="fw-bold">{{ location_count }} location{{ location_count|pluralize }}</p>

              <h6 class="text-muted mt-3">Variables</h6>
              <p class="fw-bold">{{ variable_count }} variable{{ variable_count|pluralize }}</p>

              <h6 class="text-muted mt-3">Estimated Observations</h6>
              <p class="fw-bold">~{{ estimated_observations|floatformat:0 }} data points</p>
            </div>
          </div>

          <div class="alert alert-warning mt-4">
            <strong>Note:</strong> This process may take several minutes depending on the amount of data to retrieve. 
            The request will run in the background, and you can monitor its progress on the request detail page.
          </div>

          <form method="post" class="mt-4">
            {% csrf_token %}
            <div class="d-flex justify-content-between">
              <a href="{% url 'climate:request_detail' climate_request.id %}" class="btn btn-secondary">
                Cancel
              </a>
              <button type="submit" class="btn btn-primary btn-lg">
                Start Processing Climate Data
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Additional Information -->
      <div class="card shadow mt-4">
        <div class="card-body">
          <h5>What happens next?</h5>
          <ol>
            <li>Climate data will be fetched from {{ climate_request.data_source.name }}</li>
            <li>Data will be processed and aligned with your study locations and time periods</li>
            <li>Climate observations will be stored in the harmonised database</li>
            <li>You'll be able to download the integrated dataset as CSV</li>
            <li>The data will be available for analysis with your health data</li>
          </ol>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}